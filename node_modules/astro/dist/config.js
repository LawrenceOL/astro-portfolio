var __defProp = Object.defineProperty;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, {enumerable: true, configurable: true, writable: true, value}) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
import path from "path";
import {existsSync} from "fs";
import getPort from "get-port";
const type = (thing) => Array.isArray(thing) ? "Array" : typeof thing;
function validateConfig(config) {
  var _a, _b, _c, _d, _e, _f, _g;
  if (config === void 0 || config === null)
    throw new Error(`[config] Config empty!`);
  if (typeof config !== "object")
    throw new Error(`[config] Expected object, received ${typeof config}`);
  for (const key of ["projectRoot", "pages", "dist", "public"]) {
    if (config[key] !== void 0 && config[key] !== null && typeof config[key] !== "string") {
      throw new Error(`[config] ${key}: ${JSON.stringify(config[key])}
  Expected string, received ${type(config[key])}.`);
    }
  }
  for (const key of ["sitemap"]) {
    if (config[key] !== void 0 && config[key] !== null && typeof config[key] !== "boolean") {
      throw new Error(`[config] ${key}: ${JSON.stringify(config[key])}
  Expected boolean, received ${type(config[key])}.`);
    }
  }
  if (config.buildOptions) {
    if (config.buildOptions.site !== void 0) {
      if (typeof config.buildOptions.site !== "string")
        throw new Error(`[config] buildOptions.site is not a string`);
      try {
        new URL(config.buildOptions.site);
      } catch (err) {
        throw new Error("[config] buildOptions.site must be a valid URL");
      }
    }
  }
  if (typeof ((_a = config.devOptions) == null ? void 0 : _a.port) !== "number") {
    throw new Error(`[config] devOptions.port: Expected number, received ${type((_b = config.devOptions) == null ? void 0 : _b.port)}`);
  }
  if (typeof ((_c = config.devOptions) == null ? void 0 : _c.hostname) !== "string") {
    throw new Error(`[config] devOptions.hostname: Expected string, received ${type((_d = config.devOptions) == null ? void 0 : _d.hostname)}`);
  }
  if (((_e = config.devOptions) == null ? void 0 : _e.tailwindConfig) !== void 0 && typeof ((_f = config.devOptions) == null ? void 0 : _f.tailwindConfig) !== "string") {
    throw new Error(`[config] devOptions.tailwindConfig: Expected string, received ${type((_g = config.devOptions) == null ? void 0 : _g.tailwindConfig)}`);
  }
}
async function configDefaults(userConfig) {
  const config = __spreadValues({}, userConfig || {});
  if (!config.projectRoot)
    config.projectRoot = ".";
  if (!config.src)
    config.src = "./src";
  if (!config.pages)
    config.pages = "./src/pages";
  if (!config.dist)
    config.dist = "./dist";
  if (!config.public)
    config.public = "./public";
  if (!config.devOptions)
    config.devOptions = {};
  if (!config.devOptions.port)
    config.devOptions.port = await getPort({port: getPort.makeRange(3e3, 3050)});
  if (!config.devOptions.hostname)
    config.devOptions.hostname = "localhost";
  if (!config.buildOptions)
    config.buildOptions = {};
  if (!config.markdownOptions)
    config.markdownOptions = {};
  if (typeof config.buildOptions.sitemap === "undefined")
    config.buildOptions.sitemap = true;
  return config;
}
function normalizeConfig(userConfig, root) {
  const config = __spreadValues({}, userConfig || {});
  const fileProtocolRoot = `file://${root}/`;
  config.projectRoot = new URL(config.projectRoot + "/", fileProtocolRoot);
  config.src = new URL(config.src + "/", fileProtocolRoot);
  config.pages = new URL(config.pages + "/", fileProtocolRoot);
  config.public = new URL(config.public + "/", fileProtocolRoot);
  return config;
}
async function loadConfig(rawRoot, configFileName = "astro.config.mjs") {
  const root = rawRoot ? path.resolve(rawRoot) : process.cwd();
  const astroConfigPath = new URL(`./${configFileName}`, `file://${root}/`);
  let config;
  if (existsSync(astroConfigPath)) {
    config = await configDefaults((await import(astroConfigPath.href)).default);
  } else {
    config = await configDefaults();
  }
  validateConfig(config);
  config = normalizeConfig(config, root);
  return config;
}
export {
  loadConfig
};
//# sourceMappingURL=data:application/json;base64,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
