const validHeadElements = new Set(["!doctype", "title", "meta", "link", "style", "script", "noscript", "base"]);
class EndOfHead {
  constructor() {
    this.head = null;
    this.firstNonHead = null;
    this.parent = null;
    this.stack = [];
    this.append = () => void 0;
  }
  get found() {
    return !!(this.head || this.firstNonHead);
  }
  enter(node) {
    if (this.found) {
      return;
    }
    this.stack.push(node);
    if (!node.name) {
      return;
    }
    const name = node.name.toLowerCase();
    if (name === "head") {
      this.head = node;
      this.parent = this.stack[this.stack.length - 2];
      this.append = this.appendToHead;
      return;
    }
    if (!validHeadElements.has(name)) {
      this.firstNonHead = node;
      this.parent = this.stack[this.stack.length - 2];
      this.append = this.prependToFirstNonHead;
      return;
    }
  }
  leave(_node) {
    this.stack.pop();
  }
  appendToHead(...nodes) {
    var _a;
    const head = this.head;
    head.children = (_a = head.children) != null ? _a : [];
    head.children.push(...nodes);
  }
  prependToFirstNonHead(...nodes) {
    var _a, _b, _c;
    let idx = ((_a = this.parent) == null ? void 0 : _a.children.indexOf(this.firstNonHead)) || 0;
    (_c = (_b = this.parent) == null ? void 0 : _b.children) == null ? void 0 : _c.splice(idx, 0, ...nodes);
  }
}
export {
  EndOfHead
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL2NvbXBpbGVyL3RyYW5zZm9ybS91dGlsL2VuZC1vZi1oZWFkLnRzIl0sCiAgIm1hcHBpbmdzIjogIkFBRUEsTUFBTSxvQkFBb0IsSUFBSSxJQUFJLENBQUMsWUFBWSxTQUFTLFFBQVEsUUFBUSxTQUFTLFVBQVUsWUFBWTtBQUVoRyxnQkFBZ0I7QUFBQSxFQUFoQixjQUpQO0FBS1UsZ0JBQTRCO0FBQzVCLHdCQUFvQztBQUNwQyxrQkFBOEI7QUFDOUIsaUJBQXdCO0FBRXpCLGtCQUE0QyxNQUFNO0FBQUE7QUFBQSxNQUVyRCxRQUFpQjtBQUNuQixXQUFPLENBQUMsQ0FBRSxNQUFLLFFBQVEsS0FBSztBQUFBO0FBQUEsRUFHOUIsTUFBTSxNQUFvQjtBQUN4QixRQUFJLEtBQUssT0FBTztBQUNkO0FBQUE7QUFHRixTQUFLLE1BQU0sS0FBSztBQUdoQixRQUFJLENBQUMsS0FBSyxNQUFNO0FBQ2Q7QUFBQTtBQUdGLFVBQU0sT0FBTyxLQUFLLEtBQUs7QUFFdkIsUUFBSSxTQUFTLFFBQVE7QUFDbkIsV0FBSyxPQUFPO0FBQ1osV0FBSyxTQUFTLEtBQUssTUFBTSxLQUFLLE1BQU0sU0FBUztBQUM3QyxXQUFLLFNBQVMsS0FBSztBQUNuQjtBQUFBO0FBR0YsUUFBSSxDQUFDLGtCQUFrQixJQUFJLE9BQU87QUFDaEMsV0FBSyxlQUFlO0FBQ3BCLFdBQUssU0FBUyxLQUFLLE1BQU0sS0FBSyxNQUFNLFNBQVM7QUFDN0MsV0FBSyxTQUFTLEtBQUs7QUFDbkI7QUFBQTtBQUFBO0FBQUEsRUFJSixNQUFNLE9BQXFCO0FBQ3pCLFNBQUssTUFBTTtBQUFBO0FBQUEsRUFHTCxnQkFBZ0IsT0FBdUI7QUFqRGpEO0FBa0RJLFVBQU0sT0FBTyxLQUFLO0FBQ2xCLFNBQUssV0FBVyxXQUFLLGFBQUwsWUFBaUI7QUFDakMsU0FBSyxTQUFTLEtBQUssR0FBRztBQUFBO0FBQUEsRUFHaEIseUJBQXlCLE9BQXVCO0FBdkQxRDtBQXdESSxRQUFJLE1BQWMsWUFBSyxXQUFMLG1CQUFhLFNBQVUsUUFBUSxLQUFLLGtCQUFrQjtBQUN4RSxxQkFBSyxXQUFMLG1CQUFhLGFBQWIsbUJBQXVCLE9BQU8sS0FBSyxHQUFHLEdBQUc7QUFBQTtBQUFBOyIsCiAgIm5hbWVzIjogW10KfQo=
